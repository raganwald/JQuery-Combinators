<!DOCTYPE html>  <html> <head>   <title>life.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               life.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <h1>Conway's Game of Life</h1>

<p>This implementation of <a href="https://en.wikipedia.org/wiki/Conway's_Game_of_Life">Life</a> was written to demonstrate the use of <a href="http://raganwald.github.com/JQuery-Combinators">jQuery Combinators</a>.</p>

<p>The thesis is that with jQuery Combinators, you can write your own application logic
using exactly the same fluent style that jQuery's methods use, creating a single, consistent
and easy-to-read style for your jQuery-powered JavaScript or CoffeeScript.</p>

<p>You can try it <strong><a href="./index.html">here</a></strong>. Click to toggle any cell between alive and dead. Press return
to advance a generation.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <h2>Introduction</h2>

<p>jQuery is a general-purpose library that provides a number of browser-specific functions. Its core
functionality manipulates selections of DOM entities in a fluent style. There are four fundamental
operations on a selection:</p>

<ol>
<li>Filter a selection, analagous to <code>Array.prototype.filter</code>. Special case:
Create a selection by filtering the entire document.</li>
<li>Traverse from a selection to another selection, e.g. from a selection of DOM elements
to their children.</li>
<li>Perform some operation on the selection for side effects, e.g. making the selected
elements visible.</li>
<li>Map from a selection to some other value or values, e.g from a selction to an integer
representing the size of the selection.</li>
</ol>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>jQuery provides a large number of methods that fit into one of these four categories, and
when you use its built-in methods, you can write idomatic, "fluent" jQuery code. But when you
incorporate your own logic, you have to break out of the fluent style.</p>

<h3>Life, the Universe, and jQuery</h3>

<p>Let's say we are writing an implementation of Life (because we are). And let's
say that we are representing the Life Universe as a table, with one <code>td</code> for each cell in the
universe (because we did). And live cells have the class <code>alive</code>.</p>

<p>If we wanted to select all the cells to the right of a live cell, we could do this in jQuery:
<code>$('td.alive + td')</code>. And if we wanted to filter a selection of cells to thoe that were to the
right of a live cell, we could write <code>$selection.filter('td.alive + td')</code>.</p>

<p>So far, so good. Yay jQuery. But how do we name this relationship? How do we DRY up our code?
And how do we do it in a way that naturally fits in with jQuery's style?</p>

<h3>jQuery Combinators</h3>

<p>jQuery Combinators to the rescue. jQuery Combinators provides a method called <code>.into</code> that turns
any function into a traverse, and <code>.select</code> that turns any function into a filter. So we can write:</p>

<pre><code>function liveOnTheLeft ($selection) {
  return $selection
    .filter('td.alive + td')
}
</code></pre>

<p>And now, whenever we want to use this, we can write <code>$selection.select(liveOnTheLeft)</code> just as
if <code>liveOnTheLeft</code> was a built-in jQuery filter. There's also <code>.tap</code> for turning your own
functions into methods that perform an operation and return the selection, just like jQuery's 
built-in operations.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <h2>Disclaimer</h2>

<p>For instructive purposes, this implementation of Life is gratuitously coded to do everything 
with operations on DOM elements rather than working at lightening speed on a model and then 
displaying the result in a canvas or on the DOM. This is not intended as anything except
an excuse to pack as many DOM operations as possible in the space provided.</p>

<hr />             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <h1>The Code</h1>             </td>             <td class="code">               <div class="highlight"><pre>  
<span class="p">;</span><span class="nx">jQuery</span><span class="p">(</span><span class="kd">function</span> <span class="nx">life</span><span class="p">()</span> <span class="p">{</span>
    
  <span class="kd">var</span> <span class="nx">$</span>      <span class="o">=</span> <span class="nx">jQuery</span><span class="p">,</span>
      <span class="nx">$tbody</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;table tbody&#39;</span><span class="p">),</span>
      <span class="nx">SIZE</span>   <span class="o">=</span> <span class="mi">16</span><span class="p">,</span>
      <span class="nx">iterating</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  </pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <h2>Set the page up</h2>

<p>Construct a table of cells dynamically and then set up ts click and event handlers to create
an affordance-free UI.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">buildLifeUniverse</span><span class="p">();</span>
  <span class="nx">bindEventHandlers</span><span class="p">();</span>
  </pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <h2>The core algorithm</h2>

<p>This is the core algorithm for iterating the Life Universe.
It is one continuous fluid jQuery expression, starting with a
selection of every cell</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">stepForwardOneGeneration</span> <span class="p">()</span> <span class="p">{</span>
    </pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Starting with every cell...</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;.cell&#39;</span><span class="p">)</span>
  </pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <h3>Counting Neighbours</h3>

<p>Most of the work we're going to do is counting neighbours.
This is a little complicated because the tree structure of an
HTML table is not a direct fit with the 2D structure of the
Life Universe. That's actually a good excuse to demonstrate
how to streamline complex operations, but if you ever want to
write a fast life engine, start with good data structures.</p>

<p>We'll encode the number of neighbours in a class, from <code>n0</code>
(zero neighbours) to <code>n8</code> (eight neighbours).</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;n0&#39;</span><span class="p">)</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>First, we're going to count the neighbours to the left and the right
of every cell. In addition to encoding the result from <code>n0</code> though <code>n2</code>, 
we'll also encode the result in one of three classes,
<code>lr0</code>, <code>lr1</code>, and <code>lr2</code>. This will be useful later for counting
diagonal neighbours.</p>

<pre><code>+---+---+---+
|   |   |   |
|   |   |   |
|   |   |   |
+---+---+---+
|   |   |   |
| ? | X | ? |
|   |   |   |
+---+---+---+
|   |   |   |
|   |   |   |
|   |   |   |
+---+---+---+
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;lr0&#39;</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Here's our first use of <code>.select</code>. It passes the selection to a function
that is understood to apply a filter. It has the special property of 
treating the filter as atomic, so if that function applies several filters adn/or
traverses, <code>.end()</code> will still work just as if this was a single call to jQuery's
<code>.filter</code> method.</p>

<p>We also have our first use of <code>.tap</code>. It passes the selection to a function
but always return the selection. We use that to implement operations,
such as incrementing the left-right neighbour cont by one.</p>

<p>We fnish with jQuery's <code>.end</code> to "pop the stack" and return to the original
unfiltered selection.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasOnLeftOrRight</span><span class="p">(</span><span class="s1">&#39;.alive&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">)(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>and if they have a <code>.alive</code> to the left AND right, we increment their 
neighbour count by two.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasOnLeftAndRight</span><span class="p">(</span><span class="s1">&#39;.alive&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;lr&#39;</span><span class="p">)(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Now we count whether each cell has one or two vertical neighbours.</p>

<pre><code>+---+---+---+
|   |   |   |
|   | ? |   |
|   |   |   |
+---+---+---+
|   |   |   |
|   | X |   |
|   |   |   |
+---+---+---+
|   |   |   |
|   | ? |   |
|   |   |   |
+---+---+---+
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasAboveOrBelow</span><span class="p">(</span><span class="s1">&#39;.alive&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasAboveAndBelow</span><span class="p">(</span><span class="s1">&#39;.alive&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Observation:</p>

<p>If a cell above or below us has one horizontal neighbour,
we must have one diagonal neighbour. If it has two
horizontal neighbours, we must have two diagonal neighbours.</p>

<pre><code>+---+---+---+
|   |   |   |
| ? |   | ? |
|   |   |   |
+---+---+---+
|   |   |   |
|   | X |   |
|   |   |   |
+---+---+---+
|   |   |   |
|   |   |   |
|   |   |   |
+---+---+---+
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasAboveOrBelow</span><span class="p">(</span><span class="s1">&#39;.lr1&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">1</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasAboveOrBelow</span><span class="p">(</span><span class="s1">&#39;.lr2&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>And therefore, if the cells both above and below us
have one horizontal neighbour, we must have two
diagonal neighbours</p>

<pre><code>+---+---+---+
|   |   |   |
|   |   | ? |
|   |   |   |
+---+---+---+
|   |   |   |
|   | X |   |
|   |   |   |
+---+---+---+
|   |   |   |
|   |   | ? |
|   |   |   |
+---+---+---+
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasAboveAndBelow</span><span class="p">(</span><span class="s1">&#39;.lr1&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">2</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>And finally, if the cells both above and below us
have two horizontal neighbours, we must have four
diagonal neighbours</p>

<pre><code>+---+---+---+
|   |   |   |
| ? |   | ? |
|   |   |   |
+---+---+---+
|   |   |   |
|   | X |   |
|   |   |   |
+---+---+---+
|   |   |   |
| ? |   | ? |
|   |   |   |
+---+---+---+
</code></pre>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="nx">hasAboveAndBelow</span><span class="p">(</span><span class="s1">&#39;.lr2&#39;</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">tap</span><span class="p">(</span><span class="nx">incrementNeighbourCountBy</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">)(</span><span class="mi">4</span><span class="p">))</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
    </pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>We can now discard the <code>lr</code> classes</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;lr0 lr1 lr2&#39;</span><span class="p">)</span>
    </pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <h3>Implementing Life's Rules</h3>             </td>             <td class="code">               <div class="highlight"><pre>    </pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>Any cell that is not alive and has exactly three neighbours
becomes alive</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.n3:not(.alive)&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;alive&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;easeInSine&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
        </pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p>Any cell that is alive and does not have two or three nighbours
dies</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.alive:not(.n2,.n3)&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;alive&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s1">&#39;easeInSine&#39;</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">end</span><span class="p">()</span>
      </pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p>That's it, remove the neighbour counts.</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s1">&#39;n0 n1 n2 n3 n4 n5 n6 n7 n8&#39;</span><span class="p">);</span>
      
  <span class="p">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <h2>Setup Functions</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">buildLifeUniverse</span> <span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
        <span class="nx">j</span><span class="p">,</span>
        <span class="nx">$tr</span><span class="p">;</span>

    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">SIZE</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">$tr</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;tr&gt;&lt;/tr&gt;&#39;</span><span class="p">);</span>
      <span class="k">for</span> <span class="p">(</span><span class="nx">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">j</span> <span class="o">&lt;</span> <span class="nx">SIZE</span><span class="p">;</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;&lt;td&gt;&lt;/td&gt;&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s1">&#39;cell&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="s1">&#39;h&#39;</span><span class="o">+</span><span class="nx">j</span><span class="o">+</span><span class="s1">&#39;v&#39;</span><span class="o">+</span><span class="nx">i</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">appendTo</span><span class="p">(</span><span class="nx">$tr</span><span class="p">)</span>
      <span class="p">}</span>
      <span class="nx">$tbody</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">$tr</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">bindEventHandlers</span> <span class="p">()</span> <span class="p">{</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">keyup</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">keyCode</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">stepForwardOneGeneration</span><span class="p">()</span>
        <span class="p">}</span>
      <span class="p">});</span>
    <span class="nx">$tbody</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="s1">&#39;.cell&#39;</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$</span><span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">currentTarget</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">toggleClass</span><span class="p">(</span><span class="s2">&quot;alive&quot;</span><span class="p">)</span>
      <span class="p">})</span>
  <span class="p">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <h2>The Filters</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">hasOnLeft</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasOnLeft</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$selection</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.cell&#39;</span><span class="o">+</span><span class="nx">clazz</span><span class="o">+</span><span class="s1">&#39; + .cell&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">hasOnRight</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasOnRight</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$selection</span>
        <span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;.cell.alive&#39;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">prev</span><span class="p">(</span><span class="s1">&#39;.cell&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">hasOnLeftOrRight</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasOnLeftOrRight</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">$a</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasOnLeft</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$b</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasOnRight</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$ab</span> <span class="o">=</span> <span class="nx">$a</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">$b</span><span class="p">);</span>
      
      <span class="k">return</span> <span class="nx">$a</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$b</span><span class="p">).</span><span class="nx">not</span><span class="p">(</span><span class="nx">$ab</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">hasOnLeftAndRight</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasOnLeftAndRight</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">$a</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasOnLeft</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$b</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasOnRight</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$ab</span> <span class="o">=</span> <span class="nx">$a</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">$b</span><span class="p">);</span>
      
      <span class="k">return</span> <span class="nx">$ab</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">hasAbove</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasAbove</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">$result</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">filter</span><span class="p">(),</span>
          <span class="nx">columnIndex</span><span class="p">,</span>
          <span class="nx">$column</span><span class="p">;</span>
    
      <span class="k">for</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">columnIndex</span> <span class="o">&lt;=</span> <span class="nx">SIZE</span><span class="p">;</span> <span class="nx">columnIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$column</span> <span class="o">=</span> <span class="nx">$selection</span>
          <span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">cellsInColumnByIndex</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">));</span>
        <span class="nx">$result</span> <span class="o">=</span> <span class="nx">$result</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
          <span class="nx">$column</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.cell&#39;</span><span class="o">+</span><span class="nx">clazz</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">parent</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">next</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">children</span><span class="p">()</span>
                    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">$column</span><span class="p">)</span>
        <span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">$result</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">hasBelow</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasAbove</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">$result</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(),</span>
          <span class="nx">columnIndex</span><span class="p">,</span>
          <span class="nx">$column</span><span class="p">;</span>
    
      <span class="k">for</span> <span class="p">(</span><span class="nx">columnIndex</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">columnIndex</span> <span class="o">&lt;=</span> <span class="nx">SIZE</span><span class="p">;</span> <span class="nx">columnIndex</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">$column</span> <span class="o">=</span> <span class="nx">$selection</span>
          <span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">cellsInColumnByIndex</span><span class="p">(</span><span class="nx">columnIndex</span><span class="p">));</span>
        <span class="nx">$result</span> <span class="o">=</span> <span class="nx">$result</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span>
          <span class="nx">$column</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.cell&#39;</span><span class="o">+</span><span class="nx">clazz</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">parent</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">prev</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">children</span><span class="p">()</span>
                    <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">$column</span><span class="p">)</span>
        <span class="p">)</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">$result</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">hasAboveOrBelow</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasAboveOrBelow</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">$a</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasAbove</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$b</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasBelow</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$ab</span> <span class="o">=</span> <span class="nx">$a</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">$b</span><span class="p">);</span>
      
      <span class="k">return</span> <span class="nx">$a</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="nx">$b</span><span class="p">).</span><span class="nx">not</span><span class="p">(</span><span class="nx">$ab</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">hasAboveAndBelow</span> <span class="p">(</span><span class="nx">clazz</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">hasAboveAndBelow</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">$a</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasAbove</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$b</span> <span class="o">=</span> <span class="nx">$selection</span><span class="p">.</span><span class="nx">into</span><span class="p">(</span><span class="nx">hasBelow</span><span class="p">(</span><span class="nx">clazz</span><span class="p">)),</span>
          <span class="nx">$ab</span> <span class="o">=</span> <span class="nx">$a</span><span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="nx">$b</span><span class="p">);</span>
      
      <span class="k">return</span> <span class="nx">$ab</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="kd">function</span> <span class="nx">cellsInColumnByIndex</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">cellsInColumnByIndex</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">$selection</span>
        <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.cell:nth-child(&#39;</span><span class="o">+</span><span class="nx">index</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="p">)</span>
    <span class="p">}</span>
  <span class="p">}</span>
  </pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <h2>The Sole Operation</h2>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">incrementNeighbourCountBy</span> <span class="p">(</span><span class="nx">prefix</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kd">function</span> <span class="nx">incrementNeighbourCountBy</span> <span class="p">(</span><span class="nx">number</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kd">function</span> <span class="nx">incrementNeighbourCountBy</span> <span class="p">(</span><span class="nx">$selection</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">i</span><span class="p">,</span>
            <span class="nx">was</span><span class="p">,</span>
            <span class="nx">next</span><span class="p">;</span>
    
        <span class="k">if</span> <span class="p">(</span><span class="nx">number</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span>
      
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">8</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">was</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
          <span class="nx">next</span> <span class="o">=</span> <span class="nx">prefix</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="nx">number</span><span class="p">);</span>
          <span class="nx">$selection</span>
            <span class="p">.</span><span class="nx">filter</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">was</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">was</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">next</span><span class="p">)</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">}</span>

<span class="p">});</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 